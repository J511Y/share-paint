# 실시간 대결방 (Battle) 시스템 구현 계획

## 개요
PaintShare의 핵심 기능인 "그림 스피드런 대결"을 위한 실시간 멀티플레이어 시스템입니다.

## 핵심 요구사항
1. **실시간성**: 참가자들의 드로잉 상태가 실시간으로 공유되어야 함
2. **동기화**: 타이머, 주제, 게임 상태(대기/시작/종료)가 모든 클라이언트에서 일치해야 함
3. **확장성**: 여러 개의 대결방이 동시에 안정적으로 운영되어야 함

---

## Phase 1: 인프라 및 기본 통신 (1주차) ✅ 완료

### 1.1 Socket.io 서버 설정
- `socket-server` 별도 Node.js 서버 구축 완료
- 기본 연결/해제 및 룸(Room) 관리 로직 구현 완료

### 1.2 대결방 API 및 DB 설계
- `battles` 테이블 상태 관리 (waiting, in_progress, finished)
- `battle_participants` 실시간 인원 체크
- 비밀번호 방 지원 추가

---

## Phase 2: 실시간 데이터 스트리밍 (2주차) 🔄 진행 중

### 2.1 캔버스 데이터 최적화
- [x] 기본 이미지 데이터(DataURL) 스트리밍 구현
- [ ] 드로잉 이벤트(좌표, 색상, 굵기) 기반 스트리밍으로 고도화 필요
- [ ] 데이터 전송량 최소화를 위한 바이너리 포맷(예: MessagePack) 검토

### 2.2 실시간 투표 시스템
- [x] 경기 종료 후 참가자들의 그림을 비교하고 투표하는 로직 구현 (Socket.io event 'vote')
- [x] 실시간 득표수 집계 및 우승자 선정 로직 구현

---

## Phase 3: 대결방 UI/UX (3주차) ✅ 완료

### 3.1 로비 및 방 생성 UI
- [x] 방 목록 조회 및 필터링
- [x] 대결방 생성 모달 (비밀번호, 인원, 시간 설정)
- [x] 참가 API 연동

### 3.2 게임 진행 UI
- [x] 중앙 캔버스 + 측면 참가자 실시간 미리보기 리스트
- [x] 하단 실시간 채팅창 및 시스템 메시지
- [x] 준비/시작 상태 관리

---

## 위험 요소 및 대응
- **네트워크 지연**: 보정 알고리즘(Interpolation) 적용 검토
- **동시 접속자**: Supabase Realtime과 Socket.io의 역할 분담 최적화
